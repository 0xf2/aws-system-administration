{
   "AWSTemplateFormatVersion":"2010-09-09",
   "Description":"Auto Scaling on Custom Metrics",
   "Resources":{
      "CustomMetricLaunchConfig":{
         "Type":"AWS::AutoScaling::LaunchConfiguration",
         "Properties":{
            "ImageId":"ami-43a15f3e",
            "InstanceType":"m3.medium"
         }
      },
      "CustomMetricScalingGroup":{
         "Type":"AWS::AutoScaling::AutoScalingGroup",
         "Properties":{
            "AvailabilityZones":[
               "us-east-1a"
            ],
            "Cooldown":"300",
            "DesiredCapacity":"1",
            "LaunchConfigurationName":{
               "Ref":"CustomMetricLaunchConfig"
            },
            "MaxSize":"10",
            "MinSize":"1"
         }
      },
      "ScaleUpPolicy":{
         "Type":"AWS::AutoScaling::ScalingPolicy",
         "Properties":{
            "AdjustmentType":"ChangeInCapacity",
            "AutoScalingGroupName":{
               "Ref":"CustomMetricScalingGroup"
            },
            "ScalingAdjustment":"1"
         }
      },
      "ScaleDownPolicy":{
         "Type":"AWS::AutoScaling::ScalingPolicy",
         "Properties":{
            "AdjustmentType":"ChangeInCapacity",
            "AutoScalingGroupName":{
               "Ref":"CustomMetricScalingGroup"
            },
            "ScalingAdjustment":"-1"
         }
      },
      "WaitingTasksAlarm":{
         "Type":"AWS::CloudWatch::Alarm",
         "Properties":{
            "AlarmActions":[
               {
                  "Ref":"ScaleUpPolicy"
               }
            ],
            "ComparisonOperator":"GreaterThanThreshold",
            "EvaluationPeriods":"1",
            "MetricName":"WaitingTasks",
            "Namespace":"MyAppMetrics",
            "OKActions":[
               {
                  "Ref":"ScaleDownPolicy"
               }
            ],
            "Period":"60",
            "Statistic":"Maximum",
            "Threshold":"10",
            "Unit":"Count"
         }
      }
   }
}